buttons[0].onclick = function(){
    x0 = innerWidth/2;
    y0 = innerHeight/2;    
    x = x0;
    y = y0;
    ctx.strokeStyle= plotparams.color;
    ctx.clearRect(0,0,innerWidth,innerHeight);

    ticsize = 5;
    rawinputdata = document.getElementById("datainput").value;
    arraystringdata = rawinputdata.split("\n");
    arraydata = [];
    for(var index = 0;index < arraystringdata.length;index++){
        arraydata.push(parseFloat(arraystringdata[index]));
    }
    deltax = plotparams.plotwidth/arraydata.length;
    for(var index = 0;index < arraydata.length;index++){
        x = x0 - 0.5*plotparams.plotwidth + index*deltax;
        y = y0 - plotparams.p2y*arraydata[index];
        
        ctx.beginPath(); 
        ctx.moveTo(x  - ticsize,y);
        ctx.lineTo(x + ticsize,y);
        ctx.stroke();
        ctx.beginPath(); 
        ctx.moveTo(x,y - ticsize);
        ctx.lineTo(x,y + ticsize);
        ctx.stroke();

    }
}

buttons[1].onclick = function(){
    rawinputdata = document.getElementById("datainput").value;
    arraystringdata = rawinputdata.split("\n");
    arraydata = [];
    for(var index = 0;index < arraystringdata.length;index++){
        arraydata.push(parseFloat(arraystringdata[index]));
    }

    data = encodeURIComponent(JSON.stringify(arraydata,null,"   "));
    var httpc = new XMLHttpRequest();
    var url = "filesaver.php";        
    currentFile = "tempfitdata.txt";
    httpc.open("POST", url, true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
    httpc.send("data="+data+"&filename="+currentFile);//send text to filesaver.php    
}

buttons[2].onclick = function(){
    var httpc = new XMLHttpRequest();
    var url = "runsim.php";        
    var simparams = plotparams.tn.toString() + " ";
    simparams += plotparams.t.toString() + " ";
    simparams += (plotparams.g/plotparams.p2y).toString() + " ";
    simparams += plotparams.f.toString();

    var httpc = new XMLHttpRequest();
    httpc.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            filedata = this.responseText;
            document.getElementById("datainput").value = filedata;
            rawinputdata = document.getElementById("datainput").value;
            arraystringdata = rawinputdata.split("\n");
            arraydata = [];
            for(var index = 0;index < arraystringdata.length;index++){
                arraydata.push(parseFloat(arraystringdata[index]));
            }
            redraw();
        }
    };
    httpc.open("GET", "runsim.php?simparams=" + simparams, true);
    httpc.send();
}
    

    