document.getElementById("backbutton").onclick = function(){
    pageIndex--;
    if(pageIndex < 0){
        pageIndex = pages.length - 1;
    }
    for(var index = 0;index < pages.length;index++){
        if(index != pageIndex){
            pages[index].style.display = "none";
        }
        else{
            pages[index].style.display = "block";
        }
    }
    boxes = pages[pageIndex].getElementsByClassName("box");
    shadowboxes = shadowpages[pageIndex].getElementsByClassName("box");
    cleanGlyph = boxes[boxIndex].getElementsByClassName("glyphdata")[0].innerHTML;
    currentGlyph = cleanGlyph + "0207,";
    editor.setValue(shadowboxes[boxIndex].getElementsByClassName("content")[0].innerHTML);
    if(editMode){
       for(var index = 0;index < boxes.length;index++){
           boxes[index].style.border = "block";
       }
    }
    else{
       for(var index = 0;index < boxes.length;index++){
           boxes[index].style.border = "none";
       }
    }
    redraw();
}

document.getElementById("fwdbutton").onclick = function(){
    pageIndex++;
    if(pageIndex > pages.length - 1){
        pageIndex = 0;
    }
    for(var index = 0;index < pages.length;index++){
        if(index != pageIndex){
            pages[index].style.display = "none";
        }
        else{
            pages[index].style.display = "block";
        }
    }
    boxes = pages[pageIndex].getElementsByClassName("box");
    shadowboxes = shadowpages[pageIndex].getElementsByClassName("box");
    cleanGlyph = boxes[boxIndex].getElementsByClassName("glyphdata")[0].innerHTML;
    currentGlyph = cleanGlyph + "0207,";
    editor.setValue(shadowboxes[boxIndex].getElementsByClassName("content")[0].innerHTML);
    if(editMode){
       for(var index = 0;index < boxes.length;index++){
           boxes[index].style.border = "block";
       }
    }
    else{
       for(var index = 0;index < boxes.length;index++){
           boxes[index].style.border = "none";
       }
    }
    redraw();
}


document.getElementById("editmodebutton").onclick = function(){
    if(editMode){
       document.getElementById("glyphspellinput").style.display = "none"; 
       document.getElementById("controlTable").style.display = "none"; 
       document.getElementById("editorlink").style.display = "none"; 
       document.getElementById("maineditor").style.display = "none"; 
       for(var index = 0;index < boxes.length;index++){
           boxes[index].style.border = "none";
       }
    }
    else{
       document.getElementById("glyphspellinput").style.display = "block"; 
       document.getElementById("controlTable").style.display = "block"; 
       document.getElementById("editorlink").style.display = "block"; 
       document.getElementById("maineditor").style.display = "block"; 
       for(var index = 0;index < boxes.length;index++){
           boxes[index].style.border = "solid";
       }
    }

    editMode = !editMode;
    redraw();
}

document.getElementById("glyphspellinput").onchange = function(){
    cleanGlyph = this.value;
    currentGlyph = cleanGlyph + "0207,";
    redraw();
}


controls[1].onkeydown = function(e) {
        charCode = e.keyCode || e.which;
        if(charCode == 010){
            doTheThing(010);
            redraw();
        }
        if(charCode == 045){
            doTheThing(020);
            redraw();
        }
        if(charCode == 047){
            doTheThing(021);
            redraw();
        }


        if(charCode == 046){
            boxIndex--;
            if(boxIndex < 0){
                boxIndex = boxes.length-1;
            }
            cleanGlyph = boxes[boxIndex].getElementsByClassName("glyphdata")[0].innerHTML;
            editor.setValue(shadowboxes[boxIndex].getElementsByClassName("content")[0].innerHTML);

            currentGlyph = cleanGlyph + "0207,";
            redraw();
        }
        if(charCode == 050){
            boxIndex++;
            if(boxIndex > boxes.length-1){
                boxIndex = 0;
            }
            editor.setValue(shadowboxes[boxIndex].getElementsByClassName("content")[0].innerHTML);
            cleanGlyph = boxes[boxIndex].getElementsByClassName("glyphdata")[0].innerHTML;
            currentGlyph = cleanGlyph + "0207,";
            redraw();
        }
        
        
        
    }
    

controls[1].onkeypress = function(a){//action
    charCode = a.keyCode || a.which;
    console.log(a.which);
    if(charCode != 010 && charCode != 045 && charCode != 047 && charCode != 046  && charCode != 050){
            
        if(parseInt(currentTable[charCode],8) >= 0200){
            var glyphSplit = currentGlyph.split(",");
            currentGlyph = "";
            for(var index = 0;index < glyphSplit.length;index++){
                if(glyphSplit[index].length > 0 && glyphSplit[index] != "0207"){
                    currentGlyph += glyphSplit[index] + ",";
                }
                if(glyphSplit[index] == "0207"){
                    currentGlyph += currentTable[charCode] + ",0207,";
                }
            }
            var glyphSplit = currentGlyph.split(",");
            currentGlyph = "";
            for(var index = 0;index < glyphSplit.length;index++){
                if(glyphSplit[index].length > 0  && parseInt(glyphSplit[index]) >= 040){
                    currentGlyph += glyphSplit[index] + ",";
                }
            }
            redraw();
        } 
        if(parseInt(currentTable[charCode],8) < 040){
            doTheThing(parseInt(currentTable[charCode],8));
            redraw();
        }
        this.value = "";
    }
}
    
    
document.getElementById("maineditor").onkeyup = function(){
    data = editor.getSession().getValue();
    shadowboxes[boxIndex].getElementsByClassName("content")[0].innerHTML = data;
    boxes[boxIndex].getElementsByClassName("content")[0].innerHTML = data;
    redraw();
}
    


   